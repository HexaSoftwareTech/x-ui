<!DOCTYPE html>
<html lang="en">
{{template "head" .}}
<style>
    @media (min-width: 769px) {
        .ant-layout-content {
            margin: 24px 16px;
        }
    }

    .ant-col-sm-24 {
        margin-top: 10px;
    }
</style>
<body>
<a-layout id="app" v-cloak>
    {{ template "commonSider" . }}
    <a-layout id="content-layout">
        <a-layout-content>
            <a-spin :spinning="spinning" :delay="500" tip="loading">
                <transition name="list" appear>
                    <a-card hoverable>
                        <div slot="title">
                            <a-button type="primary" icon="plus" @click="openAddMirror"></a-button>
                        </div>
                        <a-table :columns="columns" :row-key="dbMirrors => dbMirrors.id"
                                 :data-source="dbMirrors"
                                 :loading="spinning" :scroll="{ x: 1500 }"
                                 :pagination="false"
                                 style="margin-top: 20px"
                                 @change="() => getMirrors()">
                        </a-table>
                    </a-card>
                </transition>
            </a-spin>
        </a-layout-content>
    </a-layout>
</a-layout>
{{template "js" .}}
<script>

    const columns = [ {
        title: "ip",
        align: 'center',
        dataIndex: "ip",
        width: 30,
    }, {
        title: 'port',
        align: 'center',
        dataIndex: "port",
        width: 60,
    }];
    const app = new Vue({
        delimiters: ['[[', ']]'],
        el: '#app',
        data: {
            siderDrawer,
            spinning: false,
            mirrors: [],
            dbMirrors: []
        },
        methods: {
            loading(spinning = true) {
                this.spinning = spinning;
            },
            async getMirrors() {
                this.loading();
                // const msg = await HttpUtil.post('/xui/inbound/list');
                this.loading(false);
                // if (!msg.success) {
                //     return;
                // }
                this.setMirrors([{ip:'192.168.1.10',port:'8080',id:1}]);
            },
            setMirrors(mirrors) {
                for (const mirror of mirrors) {
                    const dbMirror = new Mirror({port: mirror.port,ip:mirror.ip,id:mirror.id});
                    this.mirrors.push(dbMirror);
                    this.dbMirrors.push(dbMirror);
                }
            },
            openAddMirror() {
                mirrorModal.show({
                    title: 'add mirror',
                    okText: 'add',
                    cancelText: '{{ i18n "close" }}',
                    confirm: async () => {
                        mirrorModal.loading();
                        await this.addMirror();
                        mirrorModal.close();
                    },
                });
            },
            async addMirror(ip,port) {
                const data = {
                    ip:ip,
                    port:port
                };
                await this.submit('/api/inbound/add', data, inModal);

                },
            async submit(url, data, modal) {
                const msg = await HttpUtil.postWithModal(url, data, modal);
                if (msg.success) {
                    await this.getMirrors();
                }
            },
        },
        mounted() {
            this.getMirrors();
        },
    });


</script>

{{template "mirrorModal"}}
{{template "promptModal"}}


</body>

</html>